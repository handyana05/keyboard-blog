{% assign h = include.html %}

{% comment %}
  Simple TOC: captures h2 headings from rendered HTML.
  Works well for long posts with clear H2 sections.
{% endcomment %}

{% assign toc_items = "" %}

{% for block in h | split: "<h2" %}
  {% if forloop.first %}{% continue %}{% endif %}
  {% assign id_part = block | split: 'id="' %}
  {% if id_part.size > 1 %}
    {% assign id = id_part[1] | split: '"' | first %}
    {% assign title_part = block | split: ">" %}
    {% assign title_raw = title_part[1] | split: "</h2" | first %}
    {% assign title = title_raw | strip_html | strip %}
    {% assign toc_items = toc_items | append: '<li><a href="#' | append: id | append: '">' | append: title | append: '</a></li>' %}
  {% endif %}
{% endfor %}

{% if toc_items != "" %}
  <aside class="toc">
    <div class="toc-title">On this page</div>
    <ul>
      {{ toc_items }}
    </ul>
  </aside>
{% endif %}
